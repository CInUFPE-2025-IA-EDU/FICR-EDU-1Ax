name: Metrics
on:
  schedule: [{ cron: "0 3 * * *" }]
  workflow_dispatch:
jobs:
  collect:
    runs-on: ubuntu-latest
    permissions: { contents: read, pull-requests: read, actions: read }
    steps:
      - name: Generate metrics
        uses: actions/github-script@v7
        with:
          script: |
            const {owner, repo} = context.repo;
            const res = await github.rest.pulls.list({owner,repo, state:"all"});
            require("fs").writeFileSync("metrics.csv", "prs,"+res.data.length+"\n");
      - uses: actions/upload-artifact@v4
        with: { name: metrics, path: metrics.csv }
